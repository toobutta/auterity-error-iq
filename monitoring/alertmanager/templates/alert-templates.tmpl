{{ define "cluster" }}{{ .ExternalURL }}{{ end }}

{{ define "severity" }}
{{ if eq .Labels.severity "critical" }}üö®{{ else if eq .Labels.severity "high" }}‚ö†Ô∏è{{ else if eq .Labels.severity "warning" }}‚ö†Ô∏è{{ else }}‚ÑπÔ∏è{{ end }}
{{ end }}

{{ define "slack.title" }}
{{ template "severity" . }} [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.alertname }}
{{ end }}

{{ define "slack.text" }}
{{ range .Alerts }}
{{ if .Annotations.summary }}*Summary:* {{ .Annotations.summary }}{{ end }}
{{ if .Annotations.description }}*Description:* {{ .Annotations.description }}{{ end }}
*Service:* {{ .Labels.service }}{{ if .Labels.instance }} on {{ .Labels.instance }}{{ end }}
*Severity:* {{ .Labels.severity | title }}
{{ if .Labels.runbook_url }}*Runbook:* <{{ .Labels.runbook_url }}|View Runbook>{{ end }}
{{ if eq .Status "firing" }}*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}{{ else }}*Resolved:* {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
---
{{ end }}
{{ end }}

{{ define "email.subject" }}
{{ template "severity" . }} [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] [Auterity] {{ .GroupLabels.alertname }}
{{ end }}

{{ define "email.html" }}
<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; margin-bottom: 20px; }
        .alert { margin: 15px 0; padding: 15px; border-radius: 4px; border-left: 4px solid; }
        .critical { background-color: #ffeaea; border-left-color: #d73527; }
        .high { background-color: #fff3cd; border-left-color: #856404; }
        .warning { background-color: #fff3cd; border-left-color: #856404; }
        .info { background-color: #d1ecf1; border-left-color: #0c5460; }
        .label { font-weight: bold; color: #333; }
        .value { color: #666; }
        .resolved { background-color: #d4edda; border-left-color: #155724; }
        .footer { margin-top: 20px; padding-top: 10px; border-top: 1px solid #e0e0e0; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>{{ template "severity" . }} Auterity Platform Alert</h2>
            <p><strong>Status:</strong> {{ .Status | title }} | <strong>Alert Group:</strong> {{ .GroupLabels.alertname }}</p>
        </div>

        {{ range .Alerts }}
        <div class="alert {{ if eq .Status "resolved" }}resolved{{ else }}{{ .Labels.severity }}{{ end }}">
            <h3>{{ .Annotations.summary }}</h3>

            {{ if .Annotations.description }}
            <p><span class="label">Description:</span> <span class="value">{{ .Annotations.description }}</span></p>
            {{ end }}

            <p><span class="label">Service:</span> <span class="value">{{ .Labels.service }}</span></p>

            {{ if .Labels.instance }}
            <p><span class="label">Instance:</span> <span class="value">{{ .Labels.instance }}</span></p>
            {{ end }}

            <p><span class="label">Severity:</span> <span class="value">{{ .Labels.severity | title }}</span></p>

            {{ if eq .Status "firing" }}
            <p><span class="label">Started:</span> <span class="value">{{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</span></p>
            {{ else }}
            <p><span class="label">Resolved:</span> <span class="value">{{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}</span></p>
            {{ end }}

            {{ if .Labels.runbook_url }}
            <p><span class="label">Runbook:</span> <a href="{{ .Labels.runbook_url }}">{{ .Labels.runbook_url }}</a></p>
            {{ end }}

            {{ if .GeneratorURL }}
            <p><span class="label">View in Prometheus:</span> <a href="{{ .GeneratorURL }}">Open Query</a></p>
            {{ end }}
        </div>
        {{ end }}

        <div class="footer">
            <p>This alert was generated by Auterity Platform Monitoring at {{ .CommonAnnotations.timestamp }}.</p>
            <p>For support, contact: ops@auterity.local</p>
        </div>
    </div>
</body>
</html>
{{ end }}

{{ define "pagerduty.description" }}
{{ range .Alerts }}{{ .Annotations.summary }}{{ if .Annotations.description }} - {{ .Annotations.description }}{{ end }}{{ end }}
{{ end }}

{{ define "webhook.title" }}
{{ if eq .Status "firing" }}Alert Firing{{ else }}Alert Resolved{{ end }}
{{ end }}

{{ define "webhook.message" }}
{
  "status": "{{ .Status }}",
  "alerts": [
    {{ range $i, $alert := .Alerts }}{{ if $i }},{{ end }}
    {
      "status": "{{ $alert.Status }}",
      "labels": {
        {{ range $key, $value := $alert.Labels }}"{{ $key }}": "{{ $value }}",{{ end }}
      },
      "annotations": {
        {{ range $key, $value := $alert.Annotations }}"{{ $key }}": "{{ $value }}",{{ end }}
      },
      "startsAt": "{{ $alert.StartsAt }}",
      "endsAt": "{{ $alert.EndsAt }}",
      "generatorURL": "{{ $alert.GeneratorURL }}"
    }{{ end }}
  ],
  "groupLabels": {
    {{ range $key, $value := .GroupLabels }}"{{ $key }}": "{{ $value }}",{{ end }}
  },
  "commonLabels": {
    {{ range $key, $value := .CommonLabels }}"{{ $key }}": "{{ $value }}",{{ end }}
  },
  "commonAnnotations": {
    {{ range $key, $value := .CommonAnnotations }}"{{ $key }}": "{{ $value }}",{{ end }}
  },
  "externalURL": "{{ .ExternalURL }}",
  "version": "4",
  "groupKey": "{{ .GroupKey }}"
}
{{ end }}
